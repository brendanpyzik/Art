{% extends 'base.html' %}

{% block title %}Search{%  endblock %}

{% block script %}

  {% comment %} $.ajax ({
            url: {% url 'delete' %},
            data: {"id" : id},
            success: function(data) {
                console.log('it worked')
            }

        });{% endcomment %}
{% endblock %}

{% block content %}

    <h3>Search</h3>
    <div id="SearchForm">
        <p><form action="{% url 'query' %}" method="post">
            {% csrf_token %}
            <input type="text" name="find" default="Search">
            <button type="submit">Submit</button>
        </form></p><br>
    </div>

    {% if message %}

            <div>
                <h3>{{ message }}</h3>
            </div>

    {% endif %}
    {% if found_artists %}
        <div>
            <h3>Artists</h3>
            <p>
            {% for artist in found_artists %}
                <input type="button" value="Delete"> &nbsp;
                <a href="{% url 'artist' artist.id %}">{{ artist }}</a><br>
            {% endfor %}
            </p>
            {% if found_artist_pieces %}
                <h3>Pieces</h3>
                <p>
                {% for piece in found_artist_pieces %}
                    <input type="button" value="{{ piece.id }}"> &nbsp;
                    <a href="{% url 'piece' piece.id %}">{{ piece.title }}</a><br>
                {% endfor %}
                </p>
            {% endif %}


        </div>
    {% endif %}
    {% if found_pieces %}
        <div>
            <h3>Pieces</h3>
            {% for piece in found_pieces %}
                <input type="button" id="delete" value="Delete" onclick="deleteItem({{ piece.id }});"> &nbsp;
                <a href="{% url 'piece' piece.id %}">{{ piece.title }}</a> by <a href="{% url 'artist' piece.artist.id %}">{{ piece.artist }}</a>
                <br>
            {% endfor %}
            </p>
        </div>
    {% endif %}

    <script>

    function deleteItem(id) {

        console.log(id);

        $.ajax({
            url: '{% url 'delete' %}',
            dataType: 'json',
            data: {'id' : id},
            method: 'GET',
            success: function (response) {
                if(response == 'okay'){
                    //
                }
                console.log(response);

            },
            error: function (jqXHR, exception) {
                var msg = '';
                if (jqXHR.status === 0) {
                    msg = 'Not connect.\n Verify Network.';
                } else if (jqXHR.status == 404) {
                    msg = 'Requested page not found. [404]';
                } else if (jqXHR.status == 500) {
                    msg = 'Internal Server Error [500].';
                } else if (exception === 'parsererror') {
                    msg = 'Requested JSON parse failed.';
                } else if (exception === 'timeout') {
                    msg = 'Time out error.';
                } else if (exception === 'abort') {
                    msg = 'Ajax request aborted.';
                } else {
                    msg = 'Uncaught Error.\n' + jqXHR.responseText;
                }
                console.log(msg);
            }
        });
    }
    </script>
    <button type="button" onclick="deleteItem(1);"> Test</button>
{% endblock content %}